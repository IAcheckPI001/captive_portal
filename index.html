<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Connect WiFi</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Tránh cache captive portal -->
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
  <meta http-equiv="Pragma" content="no-cache">
  <meta http-equiv="Expires" content="0">

  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
      background: #f9fafb;
      text-align: center;
      padding-top: 60px;
    }
    button {
      font-size: 18px;
      padding: 16px 32px;
      background: #2563eb;
      color: #fff;
      border: none;
      border-radius: 10px;
      cursor: pointer;
    }
    button:disabled {
      background: #9ca3af;
    }
  </style>
</head>
<body>

  <h2>WiFi Miễn Phí</h2>
  <p>Bấm nút bên dưới để vào Internet</p>

  <button id="btn" disabled>Đang tải...</button>

<script>
(function () {
  const qs = new URLSearchParams(window.location.search);

  const clientMac = qs.get("clientMac");
  const apMac     = qs.get("apMac");
  const t         = qs.get("t");
  const site      = qs.get("site");

  const btn = document.getElementById("btn");

  if (!clientMac || !apMac || !t || !site) {
    btn.textContent = "Thiếu tham số portal";
    return;
  }

  btn.disabled = false;
  btn.textContent = "Kết nối WiFi";

  let clicked = false;

  btn.onclick = function () {
    if (clicked) return;
    clicked = true;

    btn.disabled = true;
    btn.textContent = "Đang kết nối...";

    const authorizeUrl =
      "https://aps1-omada-essential-controller.tplinkcloud.com/app/authorize" +
      "?clientMac=" + encodeURIComponent(clientMac) +
      "&apMac=" + encodeURIComponent(apMac) +
      "&t=" + encodeURIComponent(t) +
      "&site=" + encodeURIComponent(site);

    window.location.href = authorizeUrl;
  };
})();
</script>

</body>
</html>